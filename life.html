<html>
  <body onload="run()">
    <canvas id="C"></canvas>
    <input id="I" type="checkbox" />Run
  </body>
  <script lang="jscript">
    function run(){
        k = 40, g = 10, b = [];
        function dt(val){return ~~val;}
        setInterval(function() {
            c = [];
            for (y = k * k; y--;) {
                n = 0;
                for (f = 9; f--;) n += b[(dt(y / k) + k + f % 3 - 1) % k * k + (y + k + dt(f / 3) - 1) % k];
                c[y] = n == 3 || n - b[y] == 3;
                r.fillStyle = b[y] ? 'red' : 'tan';
                r.fillRect(y % k * g, dt(y / k) * g, g - 1, g - 1)
            }
            if (document.getElementById('I').checked) {b = c}
        }, 1);

        v = document.getElementById('C');
        v.width = v.height = g * k;
        v.addEventListener('click', function(e) {
            b[dt((e.pageY - v.offsetTop) / g) * k + dt((e.pageX - v.offsetLeft) / g)] ^= 1
        }, 0);
        r = v.getContext('2d');
        for (y = k * k; y--;) b[y] = dt(Math.random() +0.5);
    }
  </script>
</html>
